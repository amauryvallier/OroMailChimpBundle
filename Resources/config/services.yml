parameters:
    # The number of records to return. Default value is 10. Maximum value is 1000
    oro_mailchimp.client.merge_fields_count: 100
    # If skip_merge_validation is true, member data will be accepted without merge field values,
    # even if the merge field is usually required. This defaults to false.
    oro_mailchimp.client.member_skip_merge_validation: false

services:
    oro_mailchimp.client.config:
        class: 'Oro\Bundle\MailChimpBundle\Client\MailChimpClientConfig'
        calls:
            - ['setMergeFieldsCount', ['%oro_mailchimp.client.merge_fields_count%']]
            - ['setMemberSkipMergeValidation', ['%oro_mailchimp.client.member_skip_merge_validation%']]

    oro_mailchimp.client.factory:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\MailChimpClientFactory'
        calls:
            - ['setClientConfig', ['@oro_mailchimp.client.config']]

    Oro\Bundle\MailChimpBundle\Provider\Transport\MailChimpClientFactory:
        alias: 'oro_mailchimp.client.factory'

    oro_mailchimp.transport.mailchimp:
        class: 'Oro\Bundle\MailChimpBundle\Transport\MailChimpTransport'
        tags:
            - { name: "oro_campaign.email_transport" }

    oro_mailchimp.model.field_helper:
        class: 'Oro\Bundle\MailChimpBundle\Model\FieldHelper'
        arguments:
            - "@oro_entity.virtual_field_provider.config"

    oro_mailchimp.validator.email_column:
        class: 'Oro\Bundle\MailChimpBundle\Validator\EmailColumnValidator'
        arguments:
            - "@oro_marketing_list.contact_information_column_validator"
            - "@doctrine"
        tags:
            - { name: validator.constraint_validator, alias: oro_mailchimp.validator.email_column }

    oro_mailchimp.validator.unique_static_segment_name:
        class: 'Oro\Bundle\MailChimpBundle\Validator\UniqueStaticSegmentNameValidator'
        arguments:
            - "@oro_mailchimp.transport.integration_transport"
        tags:
            - { name: validator.constraint_validator, alias: oro_mailchimp.validator.unique_static_segment_name }

    oro_mailchimp.placeholder.filter.buttons_filter:
        class: 'Oro\Bundle\MailChimpBundle\Placeholder\ButtonsPlaceholderFilter'
        public: true
        arguments:
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@doctrine"

    oro_mailchimp.static_segment.manager.api:
        parent: oro_soap.manager.entity_manager.abstract
        public: true
        class: 'Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager'
        arguments:
            - 'Oro\Bundle\MailChimpBundle\Entity\StaticSegment'
            - "@doctrine.orm.entity_manager"

    # Readers
    oro_mailchimp.importexport.reader.processed_entities:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Reader\ProcessedEntities'
        arguments:
            - "@oro_importexport.context_registry"

    oro_mailchimp.importexport.reader.static_segment:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Reader\StaticSegmentReader'
        parent: oro_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setMarketingListClassName, ['Oro\Bundle\MarketingListBundle\Entity\MarketingList']]
            - [setStaticSegmentClassName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegment']]

    oro_mailchimp.importexport.reader.marketing_list_email:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.marketing_list_email"]]

    oro_mailchimp.importexport.reader.members_sync:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.member_sync"]]

    oro_mailchimp.importexport.reader.updated_members_sync:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.updated_member_sync"]]

    oro_mailchimp.importexport.reader.static_segment_member_add_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_add_state"]]

    oro_mailchimp.importexport.reader.static_segment_member_remove_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_remove_state"]]

    oro_mailchimp.importexport.reader.static_segment_member_unsubscribe_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_unsubscribe_state"]]

    oro_mailchimp.importexport.reader.static_segment_member_unsubscribe_delete_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_unsubscribe_delete_state"]]

    oro_mailchimp.importexport.reader.static_segment_member_dropped_state:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_dropped_state"]]

    oro_mailchimp.importexport.reader.abstract_iterator_based:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Reader\AbstractIteratorBasedReader'
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_entity.doctrine_helper"
            - 'Oro\Bundle\IntegrationBundle\Entity\Channel'

    oro_mailchimp.importexport.reader.member_export:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Reader\MemberExportReader'
        parent: oro_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setMemberClassName, ['Oro\Bundle\MailChimpBundle\Entity\Member']]
            - [setSubscribersListClassName, ['Oro\Bundle\MailChimpBundle\Entity\SubscribersList']]

    oro_mailchimp.importexport.reader.static_segment_export:
        parent: oro_mailchimp.importexport.reader.static_segment

    oro_mailchimp.importexport.reader.static_segment_member_out_of_list:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.static_segment_member_out_of_list"]]

    oro_mailchimp.importexport.reader.extended_merge_var_add:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.extended_merge_var_add"]]

    oro_mailchimp.importexport.reader.extended_merge_var_remove:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.extended_merge_var_remove"]]

    oro_mailchimp.importexport.reader.extended_merge_var_export:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Reader\ExtendedMergeVarExportReader'
        parent: oro_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setStaticSegmentClassName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegment']]
            - [setExtendedMergeVarClassName, ['Oro\Bundle\MailChimpBundle\Entity\ExtendedMergeVar']]

    oro_mailchimp.importexport.reader.member_extended_merge_var_add:
        parent: oro_mailchimp.importexport.reader.static_segment
        calls:
            - [setSourceIterator, ["@oro_mailchimp.iterator.mmbr_extd_merge_var"]]

    oro_mailchimp.importexport.reader.mmbr_extd_merge_var_export:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Reader\MemberExtendedMergeVarExportReader'
        parent: oro_mailchimp.importexport.reader.abstract_iterator_based
        calls:
            - [setStaticSegmentClassName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegment']]
            - [setMmbrExtdMergeVarClassName, ['Oro\Bundle\MailChimpBundle\Entity\MemberExtendedMergeVar']]

    # Writers
    oro_mailchimp.importexport.writer.template.remove:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\RemoveWriter'
        arguments:
            - "@doctrine"
            - 'Oro\Bundle\MailChimpBundle\Entity\Template'
            - 'originId'

    oro_mailchimp.importexport.writer.list.remove:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\RemoveWriter'
        arguments:
            - "@doctrine"
            - 'Oro\Bundle\MailChimpBundle\Entity\SubscribersList'
            - 'originId'

    oro_mailchimp.importexport.writer.campaign.remove:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\CampaignRemoveWriter'
        arguments:
            - "@doctrine"
            - 'Oro\Bundle\MailChimpBundle\Entity\Campaign'
            - 'originId'
            - 'regular'

    oro_mailchimp.importexport.writer.abstract_export:
        abstract: true
        parent: oro_integration.writer.persistent_batch_writer
        calls:
            - [setTransport, ["@oro_mailchimp.transport.integration_transport"]]

    oro_mailchimp.importexport.writer.member:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\MemberWriter'
        parent: oro_mailchimp.importexport.writer.abstract_export

    oro_mailchimp.importexport.writer.static_segment:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentExportWriter'
        parent: oro_mailchimp.importexport.writer.abstract_export
        calls:
            - [setStaticSegmentMemberClassName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMember']]
            - [setMemberClassName, ['Oro\Bundle\MailChimpBundle\Entity\Member']]

    oro_mailchimp.importexport.writer.extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\ExtendedMergeVarExportWriter'
        parent: oro_mailchimp.importexport.writer.abstract_export

    oro_mailchimp.importexport.writer.mmbr_extd_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\MmbrExtdMergeVarExportWriter'
        parent: oro_mailchimp.importexport.writer.abstract_export

    oro_mailchimp.importexport.writer.static_segment_member_add:
        parent: oro_importexport.writer.insert_from_select_writer
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentMemberAddStateWriter'
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMember']]
            - [setFields, [['member', 'staticSegment', 'state']]]

    oro_mailchimp.importexport.writer.static_segment_member_state:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentMemberStateWriter'
        arguments:
            - "@oro_entity.orm.native_query_executor_helper"
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMember']]

    oro_mailchimp.importexport.writer.marketing_list_email:
        parent: oro_importexport.writer.insert_from_select_writer
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\MarketingListEmailWriter'
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MarketingListEmail']]
            - [setFields, [['marketingList', 'email', 'state']]]

    oro_mailchimp.importexport.writer.prepare_static_segment_member_to_remove:
        parent: oro_importexport.writer.insert_from_select_writer
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\StaticSegmentMemberToRemoveWriter'
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMemberToRemove']]
            - [setFields, [['member', 'staticSegment', 'state']]]

    oro_mailchimp.importexport.writer.members_sync:
        parent: oro_importexport.writer.insert_from_select_writer
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\MemberSyncWriter'
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Member']]
            - [setFields, [['owner', 'subscribersList', 'channel', 'status', 'createdAt', 'mergeVarValues']]]

    oro_mailchimp.importexport.writer.updated_members_sync:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\UpdatedMemberSyncWriter'
        arguments:
            - '@oro_entity.doctrine_helper'

    oro_mailchimp.importexport.writer.loggable_persistent_batch_writer:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Writer\LoggablePersistentBatchWriter'
        parent: oro_integration.writer.persistent_batch_writer

    #Serializers
    oro_mailchimp.importexport.serializer.datetime:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Serializer\DateTimeSerializer'
        tags:
            - { name: oro_importexport.normalizer }

    oro_mailchimp.importexport.serializer.member_import:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Serializer\MemberImportSerializer'
        calls:
            - [setChannelEntity, ['Oro\Bundle\IntegrationBundle\Entity\Channel']]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
            - [setDateTimeSerializer, ["@oro_mailchimp.importexport.serializer.datetime"]]
        tags:
            - { name: oro_importexport.normalizer }

    oro_mailchimp.importexport.serializer.member_activity:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Serializer\MemberActivitySerializer'
        calls:
            - [setChannelEntity, ['Oro\Bundle\IntegrationBundle\Entity\Channel']]
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
            - [setDateTimeSerializer, ["@oro_mailchimp.importexport.serializer.datetime"]]
        tags:
            - { name: oro_importexport.normalizer }

    oro_mailchimp.importexport.serializer.memeber_extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Serializer\MemberExtendedMergeVarSerializer'
        arguments:
            - "@oro_entity.helper.field_helper"
            - "@oro_importexport.field.database_helper"
            - "@oro_mailchimp.marketinglist.datagrid_provider"
            - "@translator"
            - "@oro_locale.formatter.number"
            - "@oro_locale.formatter.date_time"
            - 'Oro\Bundle\MailChimpBundle\Entity\MemberExtendedMergeVar'
        calls:
            - [setDispatcher, ["@event_dispatcher"]]
            - [setScalarFieldDenormalizer, ['@oro_importexport.serializer.scalar_field_denormalizer']]
        tags:
            - { name: oro_importexport.normalizer, priority: -6 }

    # Forms and extensions
    oro_mailchimp.form.extension.channel_connectors:
        class: 'Oro\Bundle\MailChimpBundle\Form\Extension\ChannelConnectorsExtension'
        tags:
            - { name: form.type_extension, alias: oro_integration_channel_form, extended_type: Oro\Bundle\IntegrationBundle\Form\Type\ChannelType }

    oro_mailchimp.form.type.api_key_type:
        class: 'Oro\Bundle\MailChimpBundle\Form\Type\ApiKeyType'
        tags:
            - { name: form.type, alias: "oro_mailchimp_api_key_type" }

    oro_mailchimp.form.type.integration_transport_settings:
        class: 'Oro\Bundle\MailChimpBundle\Form\Type\IntegrationSettingsType'
        tags:
            - { name: form.type, alias: "oro_mailchimp_integration_transport_setting_type" }

    oro_mailchimp.form.type.integration_select:
        class: 'Oro\Bundle\MailChimpBundle\Form\Type\MailChimpIntegrationSelectType'
        arguments:
            - "@doctrine"
            - "@oro_security.acl_helper"
        tags:
            - { name: form.type, alias: "oro_mailchimp_integration_select" }

    oro_mailchimp.form.type.template_select:
        class: 'Oro\Bundle\MailChimpBundle\Form\Type\MailchimpTemplateSelectType'
        tags:
            - { name: form.type, alias: "oro_mailchimp_template_select" }

    oro_mailchimp.form.type.list_select:
        class: 'Oro\Bundle\MailChimpBundle\Form\Type\MailchimpListSelectType'
        tags:
            - { name: form.type, alias: "oro_mailchimp_list_select" }

    oro_mailchimp.form.type.transport_settings:
        class: 'Oro\Bundle\MailChimpBundle\Form\Type\MailChimpTransportSettingsType'
        tags:
            - { name: form.type, alias: "oro_mailchimp_email_transport_settings" }

    oro_mailchimp.form.type.marketing_list_connecion:
        class: 'Oro\Bundle\MailChimpBundle\Form\Type\MarketingListConnectionType'
        tags:
            - { name: form.type, alias: "oro_mailchimp_marketing_list_connection" }

    oro_mailchimp.form.type.static_segment_sync_mode:
        class: 'Oro\Bundle\MailChimpBundle\Form\Type\StaticSegmentSyncModeType'
        arguments:
            - '@oro_mailchimp.provider.static_segment_sync_mode_choices'
        tags:
            - { name: form.type }

    oro_mailchimp.form.autocomplete.template.search_handler:
        class: 'Oro\Bundle\MailChimpBundle\Autocomplete\TemplateSearchHandler'
        arguments:
            - 'Oro\Bundle\MailChimpBundle\Entity\Template'
            - ['name']
        calls:
            - [initDoctrinePropertiesByManagerRegistry, ['@doctrine']]
            - [setAclHelper, ['@oro_security.acl_helper']]
            - [setPropertyAccessor, ['@property_accessor']]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: mailchimp_templates, acl_resource: oro_email_campaign_view }

    oro_mailchimp.form.autocomplete.list.search_handler:
        class: 'Oro\Bundle\MailChimpBundle\Autocomplete\ListSearchHandler'
        arguments:
            - 'Oro\Bundle\MailChimpBundle\Entity\SubscribersList'
            - ['name']
        calls:
            - [initDoctrinePropertiesByManagerRegistry, ['@doctrine']]
            - [setAclHelper, ['@oro_security.acl_helper']]
            - [setPropertyAccessor, ['@property_accessor']]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: mailchimp_lists, acl_resource: oro_email_campaign_view }

    # Integration related services
    oro_mailchimp.provider.channel_type:
            class: 'Oro\Bundle\MailChimpBundle\Provider\ChannelType'
            tags:
                - { name: oro_integration.channel, type: mailchimp }

    oro_mailchimp.transport.integration_transport:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\MailChimpTransport'
        arguments:
            - "@oro_mailchimp.client.factory"
            - "@doctrine"
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]
        tags:
            - { name: oro_integration.transport, type: mailchimp_api, channel_type: mailchimp }

    # Connectors
    oro_mailchimp.connector.abstract:
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_integration.provider.connector_context_mediator"
        calls:
            - [setManagerRegistry, ["@doctrine"]]

    oro_mailchimp.connector.template:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\TemplateConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Template']]
#        tags:
#            - { name: oro_integration.connector, type: template, channel_type: mailchimp }

    oro_mailchimp.connector.list:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\ListConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\SubscribersList']]
        tags:
            - { name: oro_integration.connector, type: list, channel_type: mailchimp }

    oro_mailchimp.connector.campaign:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\CampaignConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Campaign']]
        tags:
            - { name: oro_integration.connector, type: campaign, channel_type: mailchimp }

    oro_mailchimp.connector.static_segment:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\StaticSegmentConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegment']]
        tags:
            - { name: oro_integration.connector, type: static_segment, channel_type: mailchimp }

    oro_mailchimp.connector.member:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\MemberConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Member']]
        tags:
            - { name: oro_integration.connector, type: member, channel_type: mailchimp }

    oro_mailchimp.connector.member_activity_send:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\MemberSendActivityConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberActivity']]
        tags:
            - { name: oro_integration.connector, type: member_activity_send, channel_type: mailchimp }

    oro_mailchimp.connector.member_activity:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\MemberActivityConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberActivity']]
        tags:
            - { name: oro_integration.connector, type: member_activity, channel_type: mailchimp }

    oro_mailchimp.connector.member_activity_abuse:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\MemberAbuseActivityConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberActivity']]
        tags:
            - { name: oro_integration.connector, type: member_activity_abuse, channel_type: mailchimp }

    oro_mailchimp.connector.member_activity_unsubscribe:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Connector\MemberUnsubscribeActivityConnector'
        parent: oro_mailchimp.connector.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberActivity']]
        tags:
            - { name: oro_integration.connector, type: member_activity_unsubscribe, channel_type: mailchimp }

    # Data Converter
    oro_mailchimp.importexport.data_converter.campaign:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\CampaignDataConverter'

    oro_mailchimp.importexport.data_converter.template:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\TemplateDataConverter'

    oro_mailchimp.importexport.data_converter.list:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\ListDataConverter'

    oro_mailchimp.importexport.data_converter.member:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberDataConverter'

    oro_mailchimp.importexport.data_converter.member_activity:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberActivityDataConverter'

    oro_mailchimp.importexport.data_converter.member_activity_send:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberSendActivityDataConverter'

    oro_mailchimp.importexport.data_converter.member_activity_abuse:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberAbuseActivityDataConverter'

    oro_mailchimp.importexport.data_converter.member_activity_unsubscribe:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberUnsubscribeActivityDataConverter'

    oro_mailchimp.importexport.data_converter.static_segment:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\StaticSegmentDataConverter'

    oro_mailchimp.importexport.data_converter.extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\ExtendedMergeVarDataConverter'

    oro_mailchimp.importexport.data_converter.member_extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\DataConverter\MemberExtendedMergeVarDataConverter'

    # Strategy
    oro_mailchimp.importexport.strategy.abstract.add_or_replace:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\AbstractImportStrategy'
        parent: oro_importexport.strategy.configurable_add_or_replace
        abstract: true
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]
            - [setOwnerHelper, ["@oro_integration.helper.default_owner_helper"]]

    oro_mailchimp.importexport.strategy.template.add_or_replace:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\TemplateImportStrategy'
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace

    oro_mailchimp.importexport.strategy.list:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\ListImportStrategy'
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace

    oro_mailchimp.importexport.strategy.member:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\MemberImportStrategy'
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace
        calls:
            - [setMergeVarProvider, ["@oro_mailchimp.merge_var.provider"]]

    oro_mailchimp.importexport.strategy.member_activity:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\MemberActivityImportStrategy'
        parent: oro_importexport.strategy.abstract_import_strategy
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]
            - [setOwnerHelper, ["@oro_integration.helper.default_owner_helper"]]

    oro_mailchimp.importexport.strategy.campaign:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\CampaignImportStrategy'
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace

    oro_mailchimp.importexport.strategy.static_segment:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\StaticSegmentImportStrategy'
        parent: oro_mailchimp.importexport.strategy.abstract.add_or_replace

    oro_mailchimp.importexport.strategy.export_member:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\MemberExportStrategy'
        arguments:
            - "@event_dispatcher"
            - "@oro_importexport.strategy.import.helper"
            - "@oro_entity.helper.field_helper"
            - "@oro_importexport.field.database_helper"
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Member']]
            - [setLogger, ["@oro_integration.logger.strategy"]]

    oro_mailchimp.importexport.strategy.export_static_segment:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMember']]

    oro_mailchimp.importexport.strategy.extended_merge_var:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\ExtendedMergeVar']]

    oro_mailchimp.importexport.strategy.member_extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Strategy\MemberExtendedMergeVarStrategy'
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberExtendedMergeVar']]

    oro_mailchimp.importexport.strategy.export_member_extended_merge_var:
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberExtendedMergeVar']]

    # Import Processors
    oro_mailchimp.importexport.processor.import_abstract:
        parent: oro_importexport.processor.import_abstract
        abstract: true
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]

    oro_mailchimp.importexport.processor.campaign:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.campaign"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.campaign"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Campaign']]

    oro_mailchimp.importexport.processor.list:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.list"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.list"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\SubscribersList']]

    oro_mailchimp.importexport.processor.member:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Member']]

    oro_mailchimp.importexport.processor.member_activity:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_activity"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_activity"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberActivity']]

    oro_mailchimp.importexport.processor.member_activity_send:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_activity_send"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_activity"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberActivity']]

    oro_mailchimp.importexport.processor.member_activity_abuse:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_activity_abuse"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_activity"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberActivity']]

    oro_mailchimp.importexport.processor.member_activity_unsubscribe:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_activity_unsubscribe"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_activity"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberActivity']]

    oro_mailchimp.importexport.processor.template:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.template"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.template.add_or_replace"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Template']]

    oro_mailchimp.importexport.processor.static_segment:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.static_segment"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.static_segment"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegment']]

    oro_mailchimp.importexport.processor.remove.abstract:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\RemoveProcessor'
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_entity.doctrine_helper"

    oro_mailchimp.importexport.processor.template.remove:
        parent: oro_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Template']]
            - [setSearchField, ['originId']]

    oro_mailchimp.importexport.processor.list.remove:
        parent: oro_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\SubscribersList']]
            - [setSearchField, ['originId']]

    oro_mailchimp.importexport.processor.campaign.remove:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\CampaignRemoveProcessor'
        parent: oro_mailchimp.importexport.processor.remove.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\Campaign']]
            - [setSearchField, ['originId']]
            - [setCampaignType, ['regular']]

    oro_mailchimp.importexport.processor.dummy:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\DummyProcessor'

    oro_mailchimp.importexport.processor.extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.extended_merge_var"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.extended_merge_var"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\ExtendedMergeVar']]

    oro_mailchimp.importexport.processor.member_extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ImportProcessor'
        parent: oro_mailchimp.importexport.processor.import_abstract
        calls:
            - [setDataConverter, ["@oro_mailchimp.importexport.data_converter.member_extended_merge_var"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.member_extended_merge_var"]]
            - [setEntityName, ['Oro\Bundle\MailChimpBundle\Entity\MemberExtendedMergeVar']]

    # Export Processors
    oro_mailchimp.importexport.processor.export_member:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ExportProcessor'
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.export_member"]]

    oro_mailchimp.importexport.processor.export_static_segment:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ExportProcessor'
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.export_static_segment"]]

    oro_mailchimp.importexport.processor.export_extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ExportProcessor'
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.extended_merge_var"]]

    oro_mailchimp.importexport.processor.export_member_extended_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\ImportExport\Processor\ExportProcessor'
        parent: oro_importexport.processor.export_abstract
        calls:
            - [setContextRegistry, ["@oro_importexport.context_registry"]]
            - [setStrategy, ["@oro_mailchimp.importexport.strategy.export_member_extended_merge_var"]]

    # MergeVar related services
    oro_mailchimp.merge_var.provider:
        class: 'Oro\Bundle\MailChimpBundle\Model\MergeVar\MergeVarProvider'

    # Workflow actions and conditions
    oro_mailchimp.workflow.action.abstract_marketing_list_entities:
        class: 'Oro\Bundle\MailChimpBundle\Model\Action\AbstractMarketingListEntitiesAction'
        abstract: true
        arguments:
            - "@oro_action.expression.context_accessor"
            - "@oro_marketing_list.provider.contact_information_fields"
            - "@oro_marketing_list.provider.marketing_list"
            - "@oro_mailchimp.model.field_helper"

    oro_mailchimp.workflow.action.update_email_campaign_statistics:
        class: 'Oro\Bundle\MailChimpBundle\Model\Action\UpdateEmailCampaignStatistics'
        parent: oro_mailchimp.workflow.action.abstract_marketing_list_entities
        calls:
            - [setCampaignStatisticsConnector, ["@oro_campaign.email_campaign.statistics_connector"]]
            - [setRegistry, ["@doctrine"]]
        tags:
            - { name: oro_action.action, alias: update_email_campaign_statistics }

    oro_mailchimp.workflow.action.create_marketing_list_state_item:
        parent: oro_mailchimp.workflow.action.abstract_marketing_list_entities
        calls:
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]

    oro_mailchimp.workflow.action.create_marketing_list_unsubscribed_item:
        class: 'Oro\Bundle\MailChimpBundle\Model\Action\MarketingListStateItemAction'
        parent: oro_mailchimp.workflow.action.create_marketing_list_state_item
        calls:
            - [setMarketingListStateItemClassName, ['Oro\Bundle\MarketingListBundle\Entity\MarketingListUnsubscribedItem']]
        tags:
            - { name: oro_action.action, alias: create_marketing_list_unsubscribed_item }

    oro_mailchimp.email_campaign.security.acl.voter.entity:
        class: 'Oro\Bundle\MailChimpBundle\Acl\Voter\EmailCampaignVoter'
        arguments:
            - '@oro_entity.doctrine_helper'
        calls:
            - [setClassName, ['Oro\Bundle\CampaignBundle\Entity\EmailCampaign']]
        tags:
            - { name: security.voter, priority: 500 }

    oro_mailchimp.acl.voter.marketing_list_state_item:
        class: 'Oro\Bundle\MailChimpBundle\Acl\Voter\MarketingListStateItemVoter'
        arguments:
            - '@oro_entity.doctrine_helper'
            - '@Psr\Container\ContainerInterface'
        calls:
            - [setClassName, ['Oro\Bundle\MarketingListBundle\Entity\MarketingListUnsubscribedItem']]
        tags:
            - { name: security.voter, priority: 500 }
            - { name: container.service_subscriber, id: oro_marketing_list.provider.contact_information_fields }

    oro_mailchimp.static_segment_manager.state_manager:
        class: 'Oro\Bundle\MailChimpBundle\Model\StaticSegment\StaticSegmentsMemberStateManager'
        arguments:
            - "@oro_entity.doctrine_helper"
            - 'Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMember'
            - 'Oro\Bundle\MailChimpBundle\Entity\Member'
            - 'Oro\Bundle\MailChimpBundle\Entity\MemberExtendedMergeVar'

    # Iterators
    oro_mailchimp.iterator.static_segment:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\AbstractStaticSegmentIterator'
        abstract: true
        arguments:
            - "@oro_marketing_list.provider.marketing_list"
            - "@oro_security.owner.ownership_metadata_provider"
            - 'Oro\Bundle\MarketingListBundle\Entity\MarketingListRemovedItem'
            - 'Oro\Bundle\MarketingListBundle\Entity\MarketingListUnsubscribedItem'
        calls:
            - [setSegmentMemberClassName, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMember']]

    oro_mailchimp.iterator.static_segment_members.abstract:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\AbstractStaticSegmentMembersIterator'
        parent: oro_mailchimp.iterator.static_segment
        abstract: true
        calls:
            - [setContactInformationFieldsProvider, ["@oro_marketing_list.provider.contact_information_fields"]]
            - [setFieldHelper, ["@oro_mailchimp.model.field_helper"]]
            - [setMemberClassName, ['Oro\Bundle\MailChimpBundle\Entity\Member']]

    oro_mailchimp.iterator.marketing_list_email:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\MarketingListEmailIterator'
        parent: oro_mailchimp.iterator.static_segment
        calls:
            - [setContactInformationFieldsProvider, ["@oro_marketing_list.provider.contact_information_fields"]]
            - [setFieldHelper, ["@oro_mailchimp.model.field_helper"]]

    oro_mailchimp.iterator.member_sync:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\MemberSyncIterator'
        parent: oro_mailchimp.iterator.static_segment_members.abstract
        calls:
            - [setFormatter, ["@oro_locale.dql.formatter.name"]]
            - [setMergeVarsProvider, ["@oro_mailchimp.merge_var.provider"]]
            - [setExtendMergeVarsClass, ['Oro\Bundle\MailChimpBundle\Entity\ExtendedMergeVar']]
            - [setGroupByHelper, ['@oro_query_designer.group_by_helper']]

    oro_mailchimp.iterator.updated_member_sync:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\UpdatedMemberSyncIterator'
        parent: oro_mailchimp.iterator.member_sync

    oro_mailchimp.iterator.static_segment_member_add_state:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberAddStateIterator'
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setMarketingListEmailEntity, ['Oro\Bundle\MailChimpBundle\Entity\MarketingListEmail']]
            - [setMemberEntity, ['Oro\Bundle\MailChimpBundle\Entity\Member']]

    oro_mailchimp.iterator.static_segment_member_remove_state:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberRemoveStateIterator'
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setMarketingListEmailEntity, ['Oro\Bundle\MailChimpBundle\Entity\MarketingListEmail']]
            - [setMemberEntity, ['Oro\Bundle\MailChimpBundle\Entity\Member']]

    oro_mailchimp.iterator.static_segment_member_dropped_state:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberDroppedStateIterator'
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setMemberExtendedMergeVarEntity, ['Oro\Bundle\MailChimpBundle\Entity\MemberExtendedMergeVar']]
            - [setMemberEntity, ['Oro\Bundle\MailChimpBundle\Entity\Member']]

    oro_mailchimp.iterator.static_segment_member_remove_by_state:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\StaticSegmentMemberToRemoveIterator'
        abstract: true
        calls:
            - [setRegistry, ["@doctrine"]]
            - [setMemberToRemoveEntity, ['Oro\Bundle\MailChimpBundle\Entity\StaticSegmentMemberToRemove']]

    oro_mailchimp.iterator.static_segment_member_out_of_list:
        parent: oro_mailchimp.iterator.static_segment_member_remove_by_state
        calls:
            - [setState, ['remove']]

    oro_mailchimp.iterator.static_segment_member_unsubscribe_state:
        parent: oro_mailchimp.iterator.static_segment_member_remove_by_state
        calls:
            - [setState, ['unsubscribe']]

    oro_mailchimp.iterator.static_segment_member_unsubscribe_delete_state:
        parent: oro_mailchimp.iterator.static_segment_member_remove_by_state
        calls:
            - [setState, ['unsubscribe_delete']]

    oro_mailchimp.iterator.extended_merge_var_add:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\ExtendedMergeVarAddIterator'
        arguments:
            - "@oro_mailchimp.extended_merge_var.filtered_provider"

    oro_mailchimp.iterator.extended_merge_var_remove:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\ExtendedMergeVarRemoveIterator'
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@oro_mailchimp.extended_merge_var.filtered_provider"
            - 'Oro\Bundle\MailChimpBundle\Entity\ExtendedMergeVar'

    oro_mailchimp.iterator.mmbr_extd_merge_var:
        class: 'Oro\Bundle\MailChimpBundle\Provider\Transport\Iterator\MmbrExtdMergeVarIterator'
        parent: oro_mailchimp.iterator.static_segment_members.abstract
        calls:
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
            - [setExtendMergeVarsProvider, ["@oro_mailchimp.extended_merge_var.filtered_provider"]]

    # Placeholder
    oro_mailchimp.placeholder.filter.sync_status:
        class: 'Oro\Bundle\MailChimpBundle\Placeholder\MarketingListPlaceholderFilter'
        public: true
        arguments:
            - "@doctrine"

    oro_mailchimp.placeholder.filter.email_campaign:
        class: 'Oro\Bundle\MailChimpBundle\Placeholder\EmailCampaignPlaceholderFilter'
        public: true
        arguments:
            - "@doctrine"

    oro_mailchimp.segment.column_definition.factory:
        class: 'Oro\Bundle\MailChimpBundle\Model\Segment\ColumnDefinitionListFactory'

    oro_mailchimp.extended_merge_var.composite_provider:
        class: 'Oro\Bundle\MailChimpBundle\Model\ExtendedMergeVar\Provider'

    oro_mailchimp.extended_merge_var.filtered_provider:
        class: Oro\Bundle\MailChimpBundle\Model\ExtendedMergeVar\FilteredMergeVarsProvider
        arguments:
          - '@oro_mailchimp.extended_merge_var.composite_provider'
          - '@oro_locale.dql.formatter.name'
          - '@oro_marketing_list.provider.contact_information_fields'

    oro_mailchimp.marketinglist.datagrid_provider:
        class: 'Oro\Bundle\MailChimpBundle\Model\MarketingList\DataGridProvider'
        parent: oro_marketing_list.provider.marketing_list

    oro_mailchimp.async.export_mailchimp_processor:
        class: 'Oro\Bundle\MailChimpBundle\Async\ExportMailChimpProcessor'
        arguments:
            - '@oro_entity.doctrine_helper'
            - '@oro_integration.reverse_sync.processor'
            - '@oro_mailchimp.static_segment_manager.state_manager'
            - '@oro_message_queue.job.runner'
            - '@security.token_storage'
            - '@logger'
        tags:
            - { name: 'oro_message_queue.client.message_processor' }

    oro_mailchimp.marketing_list_extend_merge_var_provider:
        class: Oro\Bundle\MailChimpBundle\Provider\MarketingListExtendedMergeVarProvider
        arguments:
            - '@oro_entity.entity_field_provider'
        tags:
            - { name: oro_mailchimp.extended_merge_vars.provider }

    oro_mailchimp.listener.notify_mailchimp:
        class: Oro\Bundle\MailChimpBundle\EventListener\NotifyMailChimpListener
        arguments:
            - '@oro_entity.doctrine_helper'
        tags:
            - { name: kernel.event_listener, event: oro_marketing_list.event.update_marketing_list, method: onMarketingListChange }

    oro_mailchimp.entity.entity_listener.channel_listener:
        class: 'Oro\Bundle\MailChimpBundle\Entity\EntityListener\ChannelListener'
        public: false
        arguments:
            - "@doctrine"
        tags:
            - { name: doctrine.orm.entity_listener, entity: 'Oro\Bundle\IntegrationBundle\Entity\Channel', event: preRemove }

    oro_mailchimp.provider.static_segment_sync_mode_choices:
        class: 'Oro\Bundle\MailChimpBundle\Provider\StaticSegmentSyncModeChoicesProvider'
        arguments:
            - '@oro_entity.doctrine_helper'
            - '@translator'

    oro_mailchimp.event_listener.members_to_update_on_entity_change_listener:
        class: Oro\Bundle\MailChimpBundle\EventListener\MailchimpMembersToUpdateOnEntityChangeListener
        arguments:
            - '@oro_entity.doctrine_helper'
            - '@oro_marketing_list.provider.marketing_list_allowed_classes'
            - '@oro_marketing_list.provider.contact_information_fields'
        tags:
            - { name: doctrine.event_listener, event: onFlush }

    oro_mailchimp.event_listener.datagrid.marketing_list_item:
        class: Oro\Bundle\MailChimpBundle\EventListener\DataGrid\MarketingListItemGridListener
        arguments:
            - '@oro_marketing_list.model.helper'
            - '@oro_marketing_list.provider.contact_information_fields'
            - '@oro_mailchimp.model.field_helper'
            - '@oro_mailchimp.placeholder.filter.sync_status'
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after, method: onBuildAfter }
